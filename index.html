<html>
<head>
<!--<meta http-equiv="Content-Security-Policy" content="default-src *; style-src *  'unsafe-inline'; script-src *  'unsafe-inline'; media-src *">-->
<title>22Sekunden</title>

<link rel="stylesheet" type="text/css" href="style.css" />
<script src="jquery-3.2.1.min.js"></script>
<script src="jquery.cookie.js"></script>
<script type = "text/javascript">
var cookie = null;




function check() {

server = document.myform.server.value;
pw = document.myform.pw.value;

link = "http://" + server + "/wifisec/login.php";

	//alert(link);

	$.ajax({
	type: "GET",
	  url: link,
	  crossDomain: true,
	data: "pw=" + pw + "&server=" + server,  
	success: function(data) {	
    //alert( $.cookie("wifisec") );
    if(data=="false") {alert("falsches PW");}
    if(data=="true") {
    	window.localStorage.setItem("wifisec", server);
    	ChangeToList();}
	},
    error: function(xhr, textStatus, errorThrown) {
    alert("keine Verbindung zum Server");
    }
});
}

function ChangeToList() {
//alert("jumped to function");
cookie = window.localStorage.getItem("wifisec");
alert(cookie);
if( cookie == null ) {alert("no cookie set yet"); return 0;} else {
//alert($.cookie('wifisec'));
link = "http://" + cookie + "/wifisec/list.php";
//alert(link);
	$.ajax({
	type: "GET",
	  url: link,
	data: "pw=nothing",
	dataType: "html",
	success: function(data) {
	//alert(data);	
    	$('#login').hide();
	$('#logout').show();
	$('#result').show();
	$('#result').html(data);
	
	},
    error: function(xhr, textStatus, errorThrown) {
    alert("keine Verbindung2 zum Server");
    logout();
    }

	
});
}
}

function logout() {
    //$.removeCookie('wifisec');
    
   // document.cookie = 'wifisec' + '=;expires:Thu, 01 Jan 1970 00:00:01 GMT;';
    //location.reload(true);
    window.localStorage.removeItem("wifisec");
    location.reload(true);
}
	
function checksession(){
	
}
	
function login(){
	user = document.myform.user.value;
	pw = document.myform.pw.value;
	
	
	link = "http://22sekunden.at/apis/app/login.php";

	//alert(link);

	$.ajax({
		type: "GET",
	  	url: link,
	  	crossDomain: true,
		data: "pw=" + pw + "&user=" + user,  
		success: function(data) {	
    			//alert( $.cookie("wifisec") );
    			if(data=="false") {
				alert("falsches PW");
				}
    			if(data=="true") {
    			window.localStorage.setItem("22sek", user);
    			ChangeToList();}
			},
    		error: function(xhr, textStatus, errorThrown) {
    		alert("keine Verbindung zum Server");
    		}
	});
}

	
function start(){
	
}

</script>

</head>

<body onload="javascript:ChangeToList()">
	
<div id="login">
<div id="logo"></div>
<div id="welcome">22Sekunden</div>
 <form name="myform" action="">
    <input name="user" type="text" autofocus placeholder="User" autocomplete="on" size="15" maxlength="50"/><br>
	<input name="pw" type="password" autofocus placeholder="Password" autocomplete="on" size="15" maxlength="15"/><br>
         <input type="button" value="Login" onclick="check();"/>
  </form>
</div>
<div id="result"></div>
<div id="logout"><a href="javascript:logout()">logout</a></div>

</body>

</html>
